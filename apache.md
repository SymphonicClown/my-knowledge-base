# Apache/Ubuntu. LAMP

---------------------------------------------------------------------------

## [Дорожная карта бекенд-разработчика](https://roadmap.sh/backend)

---------------------------------------------------------------------------

## Изменение пароля пользователя Ubuntu

---------------------------------------------------------------------------

## [Команда chpasswd](https://linux-faq.ru/page/komanda-chpasswd)
## [Как зайти под root в Ubuntu](https://losst.pro/kak-zajti-pod-root-v-ubuntu)
## [Linux: su, sudo и This account is currently not available, на примере www-data](https://it-rem.phpdev.one/linux-su-sudo-i-this-account-is-currently-not-available-na-primere-www-data.html)
## [Как посмотреть пользователей Ubuntu](https://losst.pro/kak-posmotret-spisok-polzovatelej-v-ubuntu#Как_посмотреть_список_пользователей_в_терминале)

---------------------------------------------------------------------------


Хотел зайти под www-data, но, оказывается, не знал пароля и решил его изменить/узнать.
Сначала писал в GigaChat, но его советы не подходили и простой гуглж решил проблему:
Меняем с помощью команды chpasswd:

```
chpasswd [параметры] пароли
```

пароль пользователя зашифрован и находится в файл конфигурации /etc/shadow:

```
cat /etc/shadow | grep guest
guest:$y$j9T$DjXGf6ge65ePRs2NbIm9i1$8rWie3ewmfYNSbHIEOIVJv87JgnvjZI9r73HJd3pLbB:19228:0:99999:7:::
```

Пробуем сменить пароль с помощью утилиты. Для этого достаточно использовать ее без каких-либо параметров и ввести в интерактивном режиме имя пользователя и пароль, разделив их двоеточием. Для окончания ввода и выхода из интерактивного режима следует Использовать сочетание клавиш Ctrl+D.

```
chpasswd
guest:linuxfaqisperfect
```

Снова проверим содержимое файла конфигурации.

```
# cat /etc/shadow | grep guest
guest:$y$j9T$36eh15AbQRPefTvNhOAC70$fLZwJCFwDBv0nxOcmpFe8g5Kf3zVUU2eE6J3hJ4Pkc.:19228:0:99999:7:::
```

Зашифрованный пароль изменился. Для дополнительно проверки можно воспользоваться утилитой su, позволяющей работать от лица другого пользователя.

Далее на машине локально быстренько прописал алиас в конфиге .ssh для входа под пользователем www-data

Возникает проблема: при попытке авторизоваться под www-data - прерывается авторизация и пишет 
"This account is currently not available"
Выясняется:  ошибка из-за того, что оболочка для пользователя www-data установлена в /usr/sbin/nologin, и это установлено по очень веской причине. Вы не должны входить в систему как www-data, это специальный пользователь/группа, используемая веб-сервером, не предназначенная для обычного использования shell.
Особенно плохая идея предоставлять права sudo для www-data. Если бы Apache предназначался для запуска с правами root, у него не было бы собственной группы. Делая это, вы создаете огромные дыры в безопасности. Вы были предупреждены.

## [обсуждение проблемы](https://askubuntu.com/questions/486346/this-account-is-currently-not-available-error-when-trying-to-ssh)

Поэтому сами создаем нового пользователя 


## Разделение прав пользователей

---------------------------------------------------------------------------

## [Пользователь и группа www-data](https://tokmakov.msk.ru/blog/item/439)

---------------------------------------------------------------------------

Как тру прогеры, после установки Apache нужно установить правильные права доступа для пользователей и групп.
Помогут команды chown (изменить владельца) и chmod (изменить права доступа).
Кстати, осле установки web-сервера Apache запущен под пользователем и группой www-data, директории виртуальных хостов расположены в /var/www.

Делаем овнером папку проекта - www-data:

```
chown -R www-data:www-data /var/www/your.site
```

+ задал права для файлов и директорий сайта:

```
chown -R www-data:www-data /var/www/your.site

find /var/www/wolfersen.ru/ -type d -exec chmod 750 {} \;
find /var/www/wolfersen.ru/ -type f -exec chmod 640 {} \;
```

Нам нужно обеспечить минимальные права для web-сервера (чтение директорий и файлов), чтобы он мог работать. И предоставить необходимые права на создание, редактирование и удаление файлов и директорий разработчику.
Создадим пользователя developer и назначим ему основную группу www-data:

```
$ sudo useradd -m -s /bin/bash -g www-data developer
```

Зададим пароль для нового пользователя:

```
$ sudo passwd developer
New password:
Retype new password:
passwd: password updated successfully
```

Теперь ситуация такая:

- Пользователь developer (разработчик) имеет право на чтение и запись файлов, потому что является их владельцем
- Пользователь www-data (web-сервер) имеет право на чтение файлов, потому что принадлежит к группе www-data
